# ✅ 端口转发模块 - 独立菜单和权限配置完成

## 🎉 配置总结

端口转发模块已成功配置为独立的顶级菜单，包含完整的菜单结构和API权限。

---

## 📊 菜单结构

```
📁 端口转发（顶级菜单）
    └── 📋 转发规则（子菜单）
```

### 菜单详情

| 级别 | 标题     | 路径              | 组件路径                              | 图标    | 排序 |
|------|----------|-------------------|---------------------------------------|---------|------|
| 顶级 | 端口转发 | `/portForward`    | `view/routerHolder.vue`               | position | 10   |
| 子级 | 转发规则 | `portForwardRules`| `plugin/portforward/view/portForward.vue` | list  | 1    |

---

## 🔐 API权限列表

端口转发模块包含 **7个API端点**：

| 序号 | API路径                              | 方法   | 描述                     |
|------|--------------------------------------|--------|--------------------------|
| 1    | `/portForward/createPortForward`     | POST   | 创建端口转发规则         |
| 2    | `/portForward/deletePortForward`     | DELETE | 删除端口转发规则         |
| 3    | `/portForward/deletePortForwardByIds`| DELETE | 批量删除端口转发规则     |
| 4    | `/portForward/updatePortForward`     | PUT    | 更新端口转发规则         |
| 5    | `/portForward/updatePortForwardStatus`| PUT  | 更新端口转发规则状态     |
| 6    | `/portForward/findPortForward`       | GET    | 根据ID获取端口转发规则   |
| 7    | `/portForward/getPortForwardList`    | GET    | 获取端口转发规则列表     |

---

## 📁 相关文件清单

### 后端文件

```
server/plugin/portforward/
├── plugin.go                          # 插件入口
├── initialize/
│   ├── menu.go                        # ✅ 菜单配置（已更新）
│   ├── api.go                         # ✅ API权限配置
│   ├── router.go                      # 路由配置
│   └── gorm.go                        # 数据库初始化
├── api/
│   ├── enter.go
│   └── port_forward.go
├── service/
│   ├── enter.go
│   └── port_forward.go
├── router/
│   ├── enter.go
│   └── port_forward.go
└── model/
    ├── port_forward.go
    └── request/
        └── port_forward.go
```

### 前端文件

```
web/src/plugin/portforward/
├── api/
│   └── portForward.js                 # API接口封装
├── form/
│   └── portForward.vue                # 表单组件
└── view/
    └── portForward.vue                # 管理页面
```

### 配置文档

```
项目根目录/
├── 端口转发-配置说明.md                # 详细配置说明
├── 端口转发-角色授权示例.sql          # SQL授权脚本
└── 端口转发-部署总结.md               # 本文档
```

---

## 🚀 快速部署指南

### 步骤1：注册插件

编辑 `server/main.go`，添加：

```go
import (
    "github.com/flipped-aurora/gin-vue-admin/server/plugin/portforward"
)

// 在 main() 函数中
plugin.Register(portforward.Plugin)
```

### 步骤2：编译运行

```bash
cd server
go mod tidy
go build
./server
```

### 步骤3：验证部署

#### 数据库验证

```sql
-- 查看菜单
SELECT * FROM sys_base_menus WHERE name LIKE 'portForward%';

-- 查看API
SELECT * FROM sys_apis WHERE api_group = '端口转发';
```

#### 前端验证

1. 登录系统
2. 左侧菜单栏应该看到"端口转发"顶级菜单
3. 点击展开，看到"转发规则"子菜单
4. 点击进入管理页面

### 步骤4：授权角色

#### 方式1：使用后台界面（推荐）

1. 进入"超级管理员" → "角色管理"
2. 选择角色 → 点击"设置权限"
3. 勾选"端口转发"相关权限
4. 保存

#### 方式2：使用SQL脚本

参考 `端口转发-角色授权示例.sql` 文件。

---

## ✨ 配置特点

### ✅ 已完成的配置

- ✅ **独立顶级菜单**：端口转发作为独立的一级菜单
- ✅ **子菜单结构**：转发规则作为子菜单
- ✅ **完整API权限**：7个API端点全部注册
- ✅ **自动关联**：菜单和API自动关联
- ✅ **权限细分**：支持细粒度的权限控制
- ✅ **动态路由**：前端自动从后端加载路由

### 🎯 功能特性

- ✅ 完整的CRUD操作
- ✅ 批量删除功能
- ✅ 实时状态切换
- ✅ 多条件搜索过滤
- ✅ 分页查询
- ✅ 数据验证
- ✅ 响应式UI设计

---

## 🔧 自定义配置

### 修改菜单图标

编辑 `server/plugin/portforward/initialize/menu.go`：

```go
Meta: model.Meta{Title: "端口转发", Icon: "connection"}, // 修改图标
```

### 修改菜单排序

```go
Sort: 5,  // 数字越小，显示越靠前
```

### 添加更多子菜单

在 `entities` 数组中添加更多菜单项，参考配置说明文档。

---

## 📋 验证清单

部署前请确认：

- [ ] 插件已注册到 `server/main.go`
- [ ] 已运行 `go mod tidy`
- [ ] 数据库连接正常
- [ ] 服务器有创建表和插入数据的权限
- [ ] 已为需要的角色分配权限
- [ ] 已清除浏览器缓存（如有必要）
- [ ] 已重启后端服务

---

## 🎨 界面预览

### 菜单结构

```
┌─────────────────────┐
│ 🏠 首页             │
│ 📁 热门管理         │
│ 📁 系统管理         │
│                     │
│ 📁 端口转发 ⬅       │ ← 新增顶级菜单
│   └─ 📋 转发规则     │ ← 子菜单
│                     │
│ ...                 │
└─────────────────────┘
```

### 管理页面

```
┌─────────────────────────────────────────┐
│ 端口转发管理                            │
├─────────────────────────────────────────┤
│ 搜索: [源IP] [协议] [状态] [查询] [重置] │
│                                          │
│ [新增] [删除]                           │
│                                          │
│ ┌─────────────────────────────────────┐│
│ │ □ │ 创建日期 │ 源地址 │ 协议 │ ... ││
│ ├─────────────────────────────────────┤│
│ │ □ │ 2025-01-22│ 0.0.0.0:8080│TCP │ ... ││
│ │ □ │ 2025-01-22│ 0.0.0.0:8081│UDP │ ... ││
│ └─────────────────────────────────────┘│
│                                          │
│ 上一页 1 2 3 ... 10 下一页              │
└─────────────────────────────────────────┘
```

---

## ⚠️ 注意事项

### 数据库表

- 表名：`gva_port_forward`
- 自动创建：首次启动时自动迁移
- 包含字段：ID, 创建时间, 更新时间, 源IP, 源端口, 协议, 目标IP, 目标端口, 状态, 描述

### 路由路径

- 菜单路径：`/portForward`
- 子菜单路径：`portForwardRules`
- 完整路径：`/portForward/portForwardRules`

### 权限说明

- 所有API都需要JWT认证
- 需要分配相应角色权限才能访问
- 支持Casbin权限控制

---

## 📞 问题排查

### 菜单不显示

1. 检查数据库中是否有菜单记录
2. 检查角色是否有菜单权限
3. 清除浏览器缓存
4. 重新登录

### API无权限

1. 检查Casbin规则是否正确
2. 检查角色是否有API权限
3. 查看服务器日志

### 页面404

1. 检查前端组件文件是否存在
2. 检查组件路径是否正确
3. 重新编译前端代码

---

## 🎉 部署完成

恭喜！端口转发模块已成功配置为独立菜单，包含完整的权限管理。

现在您可以：

1. ✅ 在左侧菜单看到"端口转发"顶级菜单
2. ✅ 点击展开看到"转发规则"子菜单
3. ✅ 进入管理页面进行端口转发规则管理
4. ✅ 为不同角色分配不同的权限

---

**配置完成！祝您使用愉快！** 🚀
