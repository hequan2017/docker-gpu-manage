# 端口转发管理模块 - 菜单和权限配置说明

## 📋 配置概述

本文档说明端口转发模块的菜单和API权限配置。

## 🎯 菜单结构

### 菜单层级
```
端口转发（顶级菜单）
└── 转发规则（子菜单）
```

### 菜单详情

#### 1. 顶级菜单：端口转发
- **菜单ID**: 自动生成
- **父菜单ID**: 0（顶级菜单）
- **路径**: `/portForward`
- **名称**: `portForward`
- **组件**: `view/routerHolder.vue`
- **排序**: 10
- **标题**: 端口转发
- **图标**: position
- **可见性**: 显示

#### 2. 子菜单：转发规则
- **菜单ID**: 自动生成
- **父菜单ID**: 自动关联到顶级菜单
- **路径**: `portForwardRules`
- **名称**: `portForwardRules`
- **组件**: `plugin/portforward/view/portForward.vue`
- **排序**: 1
- **标题**: 转发规则
- **图标**: list
- **可见性**: 显示

## 🔐 API权限配置

### 权限列表

端口转发模块包含以下API权限：

| 序号 | API路径                  | 方法   | 描述                 | API分组  |
|------|--------------------------|--------|----------------------|----------|
| 1    | `/portForward/createPortForward` | POST   | 创建端口转发规则     | 端口转发 |
| 2    | `/portForward/deletePortForward` | DELETE | 删除端口转发规则     | 端口转发 |
| 3    | `/portForward/deletePortForwardByIds` | DELETE | 批量删除端口转发规则 | 端口转发 |
| 4    | `/portForward/updatePortForward` | PUT    | 更新端口转发规则     | 端口转发 |
| 5    | `/portForward/updatePortForwardStatus` | PUT    | 更新端口转发规则状态 | 端口转发 |
| 6    | `/portForward/findPortForward` | GET    | 根据ID获取端口转发规则 | 端口转发 |
| 7    | `/portForward/getPortForwardList` | GET    | 获取端口转发规则列表 | 端口转发 |

## 🚀 部署步骤

### 后端部署

#### 1. 注册插件

编辑 `server/main.go`，确保插件已注册：

```go
package main

import (
    // ... 其他导入
    "github.com/flipped-aurora/gin-vue-admin/server/plugin/portforward"
)

func main() {
    // ... 其他代码

    // 注册端口转发插件
    plugin.Register(portforward.Plugin)

    // ... 其他代码
}
```

#### 2. 编译运行

```bash
cd server
go mod tidy
go build
./server
```

#### 3. 自动初始化

插件启动时会自动执行以下操作：
- ✅ 创建数据库表 `gva_port_forward`
- ✅ 注册菜单到 `sys_base_menus` 表
- ✅ 注册API到 `sys_apis` 表
- ✅ 注册路由到系统

### 前端部署

前端无需额外配置，菜单和路由会从后端动态加载。

## 🔍 验证部署

### 1. 检查数据库表

#### 检查菜单表
```sql
SELECT * FROM sys_base_menus WHERE name IN ('portForward', 'portForwardRules');
```

期望输出：
- 2条记录（父菜单和子菜单）
- 父菜单的 parent_id = 0
- 子菜单的 parent_id = 父菜单的 ID

#### 检查API表
```sql
SELECT * FROM sys_apis WHERE path LIKE '/portForward%';
```

期望输出：
- 7条记录（7个API端点）
- api_group = '端口转发'

### 2. 检查前端显示

1. 登录系统
2. 在左侧菜单栏应该看到"端口转发"顶级菜单
3. 点击"端口转发"展开，应该看到"转发规则"子菜单
4. 点击"转发规则"进入管理页面

### 3. 检查权限

#### 为角色授权

1. 进入"系统管理" → "角色管理"
2. 选择需要授权的角色（如"管理员"）
3. 点击"设置权限"
4. 在权限树中找到"端口转发"节点
5. 勾选需要的API权限
6. 保存

#### 测试权限

使用已授权的用户登录，尝试访问端口转发管理功能。

## 📝 配置文件位置

### 后端配置
- 菜单配置: `server/plugin/portforward/initialize/menu.go`
- API配置: `server/plugin/portforward/initialize/api.go`
- 路由配置: `server/plugin/portforward/initialize/router.go`
- 插件入口: `server/plugin/portforward/plugin.go`

### 前端配置
- 视图组件: `web/src/plugin/portforward/view/portForward.vue`
- API接口: `web/src/plugin/portforward/api/portForward.js`

## ⚠️ 注意事项

1. **菜单排序**：如果菜单显示顺序不理想，可以调整 `Sort` 字段的值
2. **图标选择**：可以在 Element Plus 图标库中选择其他图标
3. **权限粒度**：API权限已经细分，可以根据需要为不同角色分配不同权限
4. **菜单缓存**：修改菜单后可能需要清除浏览器缓存或重新登录才能看到变化
5. **数据库事务**：菜单和API注册使用了幂等性设计，重复执行不会出错

## 🎨 自定义建议

### 修改菜单图标

在 `menu.go` 中修改 `Meta.Icon` 字段：

```go
Meta: model.Meta{Title: "端口转发", Icon: "connection"}, // 使用连接图标
```

### 添加更多子菜单

如果需要添加更多子菜单（如统计、日志等），在 `entities` 数组中添加更多菜单项：

```go
entities := []model.SysBaseMenu{
    // 父菜单
    {...},
    // 子菜单1
    {...},
    // 子菜单2（新增）
    {
        Path:      "portForwardStats",
        Name:      "portForwardStats",
        Hidden:    false,
        Component: "plugin/portforward/view/stats.vue",
        Sort:      2,
        Meta:      model.Meta{Title: "统计信息", Icon: "data-analysis"},
    },
}
```

### 修改菜单排序

调整 `Sort` 字段的值来改变菜单显示顺序：

```go
Sort: 5,  // 数字越小，显示越靠前
```

## 📞 技术支持

如果遇到问题，请检查：
1. 插件是否正确注册到 `main.go`
2. 数据库连接是否正常
3. 服务器日志是否有错误信息
4. 浏览器控制台是否有错误

## ✅ 部署清单

部署前请确认以下项目：

- [ ] 已将插件注册到 `server/main.go`
- [ ] 已运行 `go mod tidy`
- [ ] 数据库连接正常
- [ ] 服务器有足够的权限创建表和插入数据
- [ ] 前端已重新编译（如果修改了前端代码）
- [ ] 已为需要的角色分配权限
- [ ] 已清除浏览器缓存

---

**配置完成！** 🎉
