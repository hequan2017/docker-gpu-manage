# ç«¯å£è½¬å‘æµ‹è¯•å®Œæ•´æŒ‡å—

## ğŸš€ å¿«é€Ÿæµ‹è¯•ï¼ˆ3æ­¥å®Œæˆï¼‰

### æ–¹æ³•1ï¼šä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰â­

**ç›´æ¥åŒå‡»è¿è¡Œï¼š**
```
run_test.bat
```

### æ–¹æ³•2ï¼šä½¿ç”¨PowerShellè„šæœ¬

```powershell
cd D:\devops\test-2025\docker-gpu-manage\test
.\run_test.ps1
```

### æ–¹æ³•3ï¼šæ‰‹åŠ¨å‘½ä»¤è¡Œ

```bash
cd D:\devops\test-2025\docker-gpu-manage\test
go run test_client.go -server="127.0.0.1:8081" -count=5 -msg="Hello Test"
```

âš ï¸ **æ³¨æ„**ï¼šåœ¨PowerShellä¸­ï¼Œå‚æ•°å€¼éœ€è¦ç”¨**å¼•å·**åŒ…è£¹ï¼

---

## ğŸ“‹ å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤1ï¼šå¯åŠ¨EchoæœåŠ¡å™¨ï¼ˆç›®æ ‡æœåŠ¡ï¼‰

**æ‰“å¼€ç¬¬1ä¸ªç»ˆç«¯çª—å£ï¼š**
```bash
cd D:\devops\test-2025\docker-gpu-manage\test
go run echo_server.go 9999
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ… EchoæœåŠ¡å™¨å·²å¯åŠ¨ï¼
ğŸ“¡ ç›‘å¬åœ°å€: :9999
â° å¯åŠ¨æ—¶é—´: 2025-01-22 15:30:00
--------------------------------------------------
```

### æ­¥éª¤2ï¼šå¯åŠ¨åç«¯æœåŠ¡

**æ‰“å¼€ç¬¬2ä¸ªç»ˆç«¯çª—å£ï¼š**
```bash
cd D:\devops\test-2025\docker-gpu-manage\server
go run main.go
```

**æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤è½¬å‘å™¨å·²å¯åŠ¨ï¼š**
```
[INFO] ç«¯å£è½¬å‘è§„åˆ™åŒæ­¥å®Œæˆ
[INFO] ç«¯å£è½¬å‘å·²å¯åŠ¨ rule_id=1 source=0.0.0.0:8081 target=127.0.0.1:9999 protocol=tcp
```

### æ­¥éª¤3ï¼šåˆ›å»ºç«¯å£è½¬å‘è§„åˆ™

**é€šè¿‡å‰ç«¯åˆ›å»ºï¼š**

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8080`
2. ç™»å½•ç³»ç»Ÿ
3. å·¦ä¾§èœå•æ‰¾åˆ°"ç«¯å£è½¬å‘"
4. ç‚¹å‡»"æ–°å»º"æŒ‰é’®
5. å¡«å†™è§„åˆ™ï¼š
   - **æºIPåœ°å€**: `0.0.0.0`
   - **æºç«¯å£**: `8081`
   - **åè®®ç±»å‹**: `TCP`
   - **ç›®æ ‡IPåœ°å€**: `127.0.0.1`
   - **ç›®æ ‡ç«¯å£**: `9999`
   - **çŠ¶æ€**: **å¯ç”¨** âœ“
   - **è§„åˆ™æè¿°**: `æµ‹è¯•è½¬å‘`
6. ç‚¹å‡»"ç¡®å®š"

**æ£€æŸ¥åç«¯æ—¥å¿—ï¼š**
```
[INFO] ç«¯å£è½¬å‘å·²å¯åŠ¨ rule_id=x source=0.0.0.0:8081 target=127.0.0.1:9999 protocol=tcp
```

### æ­¥éª¤4ï¼šè¿è¡Œæµ‹è¯•

**æ‰“å¼€ç¬¬3ä¸ªç»ˆç«¯çª—å£ï¼š**

**æ–¹å¼Aï¼šä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬**
```bash
cd D:\devops\test-2025\docker-gpu-manage\test
run_test.bat
```

**æ–¹å¼Bï¼šä½¿ç”¨PowerShell**
```powershell
cd D:\devops\test-2025\docker-gpu-manage\test
.\run_test.ps1
```

**æ–¹å¼Cï¼šæ‰‹åŠ¨å‘½ä»¤ï¼ˆæ­£ç¡®æ–¹å¼ï¼‰**
```bash
cd D:\devops\test-2025\docker-gpu-manage\test
go run test_client.go -server="127.0.0.1:8081" -count=5 -msg="Hello Test"
```

âš ï¸ **å…³é”®**ï¼šåœ¨PowerShell/CMDä¸­å¿…é¡»ä½¿ç”¨å¼•å·ï¼š`-server="127.0.0.1:8081"`

---

## âœ… æˆåŠŸçš„æµ‹è¯•è¾“å‡º

### æµ‹è¯•å®¢æˆ·ç«¯è¾“å‡º

```
========================================
     ç«¯å£è½¬å‘æµ‹è¯•å®¢æˆ·ç«¯
========================================
ç›®æ ‡æœåŠ¡å™¨: 127.0.0.1:8081
æµ‹è¯•æ¶ˆæ¯: Hello Test
å‘é€æ¬¡æ•°: 5
å‘é€é—´éš”: 1000 ms
========================================

ã€ç¬¬ 1/5 æ¬¡æµ‹è¯•ã€‘
ğŸ“¡ å·²è¿æ¥åˆ°æœåŠ¡å™¨: 127.0.0.1:8081
â° æ—¶é—´: 15:30:15.123
ğŸ“¤ å‘é€: [1] Hello Test
ğŸ“¥ æ¥æ”¶: Echo: [1] Hello Test [æ—¶é—´: 15:30:15]
âœ… æµ‹è¯•é€šè¿‡

ã€ç¬¬ 2/5 æ¬¡æµ‹è¯•ã€‘
ğŸ“¡ å·²è¿æ¥åˆ°æœåŠ¡å™¨: 127.0.0.1:8081
â° æ—¶é—´: 15:30:16.234
ğŸ“¤ å‘é€: [2] Hello Test
ğŸ“¥ æ¥æ”¶: Echo: [2] Hello Test [æ—¶é—´: 15:30:16]
âœ… æµ‹è¯•é€šè¿‡

ã€ç¬¬ 3/5 æ¬¡æµ‹è¯•ã€‘
ğŸ“¡ å·²è¿æ¥åˆ°æœåŠ¡å™¨: 127.0.0.1:8081
â° æ—¶é—´: 15:30:17.345
ğŸ“¤ å‘é€: [3] Hello Test
ğŸ“¥ æ¥æ”¶: Echo: [3] Hello Test [æ—¶é—´: 15:30:17]
âœ… æµ‹è¯•é€šè¿‡

ã€ç¬¬ 4/5 æ¬¡æµ‹è¯•ã€‘
ğŸ“¡ å·²è¿æ¥åˆ°æœåŠ¡å™¨: 127.0.0.1:8081
â° æ—¶é—´: 15:30:18.456
ğŸ“¤ å‘é€: [4] Hello Test
ğŸ“¥ æ¥æ”¶: Echo: [4] Hello Test [æ—¶é—´: 15:30:18]
âœ… æµ‹è¯•é€šè¿‡

ã€ç¬¬ 5/5 æ¬¡æµ‹è¯•ã€‘
ğŸ“¡ å·²è¿æ¥åˆ°æœåŠ¡å™¨: 127.0.0.1:8081
â° æ—¶é—´: 15:30:19.567
ğŸ“¤ å‘é€: [5] Hello Test
ğŸ“¥ æ¥æ”¶: Echo: [5] Hello Test [æ—¶é—´: 15:30:19]
âœ… æµ‹è¯•é€šè¿‡

========================================
           æµ‹è¯•ç»“æœç»Ÿè®¡
========================================
æ€»æµ‹è¯•æ¬¡æ•°: 5
âœ… æˆåŠŸ: 5
âŒ å¤±è´¥: 0

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç«¯å£è½¬å‘å·¥ä½œæ­£å¸¸ï¼
========================================
```

### EchoæœåŠ¡å™¨è¾“å‡º

```
ğŸ”— æ–°è¿æ¥æ¥è‡ª: 127.0.0.1:54321

ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: [1] Hello Test
ğŸ“¤ å‘é€å“åº”: Echo: [1] Hello Test [æ—¶é—´: 15:30:15]

ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: [2] Hello Test
ğŸ“¤ å‘é€å“åº”: Echo: [2] Hello Test [æ—¶é—´: 15:30:16]

ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: [3] Hello Test
ğŸ“¤ å‘é€å“åº”: Echo: [3] Hello Test [æ—¶é—´: 15:30:17]

ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: [4] Hello Test
ğŸ“¤ å‘é€å“åº”: Echo: [4] Hello Test [æ—¶é—´: 15:30:18]

ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: [5] Hello Test
ğŸ“¤ å‘é€å“åº”: Echo: [5] Hello Test [æ—¶é—´: 15:30:19]

ğŸ”Œ è¿æ¥å·²å…³é—­: 127.0.0.1:54321
```

---

## âŒ å¸¸è§é”™è¯¯åŠè§£å†³

### é”™è¯¯1ï¼šç¼–è¯‘é”™è¯¯

```
.\test_client.go:9:2: "os" imported and not used
```

**è§£å†³**ï¼šå·²ä¿®å¤ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„test_client.go

### é”™è¯¯2ï¼šåœ°å€è§£æé”™è¯¯

```
âŒ æµ‹è¯•å¤±è´¥: è¿æ¥å¤±è´¥: dial tcp: address 127: missing port in address
ç›®æ ‡æœåŠ¡å™¨: 127
```

**åŸå› **ï¼šPowerShellè§£æå‚æ•°é”™è¯¯ï¼Œéœ€è¦ç”¨å¼•å·

**è§£å†³**ï¼š
```powershell
# âŒ é”™è¯¯å†™æ³•
go run test_client.go -server=127.0.0.1:8081 -count=5

# âœ… æ­£ç¡®å†™æ³•
go run test_client.go -server="127.0.0.1:8081" -count=5

# æˆ–ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬
run_test.bat
```

### é”™è¯¯3ï¼šè¿æ¥è¢«æ‹’ç»

```
âŒ æµ‹è¯•å¤±è´¥: è¿æ¥å¤±è´¥: dial tcp 127.0.0.1:8081: connectex: No connection could be made because the target machine actively refused it
```

**åŸå› **ï¼šç«¯å£è½¬å‘æœªå¯åŠ¨

**è§£å†³**ï¼š
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥ç«¯å£è½¬å‘è§„åˆ™æ˜¯å¦åˆ›å»º
3. æ£€æŸ¥è§„åˆ™çŠ¶æ€æ˜¯å¦ä¸º"å¯ç”¨"
4. æŸ¥çœ‹åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

### é”™è¯¯4ï¼šè¿æ¥è¶…æ—¶

```
âŒ æµ‹è¯•å¤±è´¥: è¿æ¥å¤±è´¥: dial tcp 127.0.0.1:8081: i/o timeout
```

**åŸå› **ï¼šEchoæœåŠ¡å™¨æœªå¯åŠ¨

**è§£å†³**ï¼š
```bash
cd D:\devops\test-2025\docker-gpu-manage\test
go run echo_server.go 9999
```

### é”™è¯¯5ï¼šæƒé™ä¸è¶³ï¼ˆå‰ç«¯ï¼‰

```
ç‚¹å‡»"æ–°å»º"æŒ‰é’®æ—¶æç¤º"æƒé™ä¸è¶³"
```

**è§£å†³**ï¼š
1. æ‰§è¡Œ `fix_portforward_permissions.sql`
2. é€€å‡ºç™»å½•
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
4. é‡æ–°ç™»å½•

---

## ğŸ”§ è°ƒè¯•å·¥å…·

### æ£€æŸ¥ç«¯å£å ç”¨

```bash
# Windows
netstat -ano | findstr 8081
netstat -ano | findstr 9999

# æˆ–ä½¿ç”¨PowerShell
Get-NetTCPConnection -LocalPort 8081
Get-NetTCPConnection -LocalPort 9999
```

### æµ‹è¯•ç«¯å£è¿é€šæ€§

```bash
# ä½¿ç”¨telnetï¼ˆéœ€è¦å…ˆå¯ç”¨telnetå®¢æˆ·ç«¯ï¼‰
telnet 127.0.0.1 8081

# ä½¿ç”¨PowerShell
Test-NetConnection -ComputerName 127.0.0.1 -Port 8081
```

### æŸ¥çœ‹è½¬å‘çŠ¶æ€

```bash
# é€šè¿‡APIæŸ¥çœ‹
curl http://localhost:8080/api/portForward/getAllForwarderStatus

# é¢„æœŸå“åº”
{
  "code": 0,
  "data": {
    "total_rules": 1,
    "running_forwarders": 1,
    "running_ids": [1],
    "enabled_count": 1
  }
}
```

---

## ğŸ“Š æµ‹è¯•æ£€æŸ¥æ¸…å•

æµ‹è¯•å‰è¯·ç¡®è®¤ï¼š

- [ ] EchoæœåŠ¡å™¨å·²å¯åŠ¨ï¼ˆç«¯å£9999ï¼‰
- [ ] åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£8080ï¼‰
- [ ] ç«¯å£è½¬å‘è§„åˆ™å·²åˆ›å»º
- [ ] è§„åˆ™çŠ¶æ€ä¸º"å¯ç”¨"
- [ ] åç«¯æ—¥å¿—æ˜¾ç¤º"ç«¯å£è½¬å‘å·²å¯åŠ¨"
- [ ] ä½¿ç”¨æ­£ç¡®çš„æµ‹è¯•å‘½ä»¤ï¼ˆå¸¦å¼•å·ï¼‰

---

## ğŸ‰ æµ‹è¯•æˆåŠŸæ ‡å¿—

âœ… EchoæœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯
âœ… æµ‹è¯•å®¢æˆ·ç«¯æ”¶åˆ°Echoå“åº”
âœ… æ‰€æœ‰5æ¬¡æµ‹è¯•éƒ½é€šè¿‡
âœ… åç«¯æ—¥å¿—æ˜¾ç¤ºè¿æ¥å»ºç«‹
âœ… æ²¡æœ‰é”™è¯¯ä¿¡æ¯

**çœ‹åˆ°è¿™äº›ï¼Œè¯´æ˜ç«¯å£è½¬å‘åŠŸèƒ½å®Œå…¨æ­£å¸¸å·¥ä½œï¼** ğŸš€
