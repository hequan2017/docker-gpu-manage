# AI 智能助手

## 概述

AI 智能助手功能集成智谱 GLM-4.7 大语言模型，为用户提供智能对话服务。支持多会话管理、自定义参数配置、流式输出等功能，通过直观的界面实现与 AI 的交互。

## 功能特性

### 核心功能

- ✅ **智能对话**：集成智谱 GLM-4.7 大语言模型
- ✅ **多会话管理**：支持创建多个独立对话会话
- ✅ **参数配置**：可自定义温度、最大 Token 数等参数
- ✅ **流式输出**：支持实时流式响应展示
- ✅ **会话历史**：保存完整的对话历史记录
- ✅ **配置管理**：支持多个 AI Agent 配置切换

## 数据模型

### 会话 (Conversation)

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 会话标题 | string | | 会话显示名称 |
| 所属用户 | int | | 用户ID |
| 使用的模型 | string | | 默认 glm-4-plus |
| 系统提示词 | string | | System Prompt |
| 温度参数 | float64 | | 0.7，控制随机性 |
| 最大token数 | int | | 4096 |
| 是否激活 | bool | | 是否激活状态 |

### 消息 (Message)

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 会话ID | uint | ✅ | 所属会话 |
| 角色 | string | ✅ | user/assistant/system |
| 内容 | text | ✅ | 消息内容 |
| Token使用 | json | | Token统计信息 |

### AI配置 (AgentConfig)

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 配置名称 | string | ✅ | 唯一标识 |
| API Key | string | ✅ | 智谱 API 密钥 |
| API基础URL | string | | 默认智谱 API 地址 |
| 默认模型 | string | | 默认 glm-4-plus |
| 默认温度 | float64 | | 默认 0.7 |
| 默认最大token数 | int | | 默认 4096 |
| 是否启用 | bool | | 是否启用 |

## 使用指南

### 创建会话

1. 进入【AI 智能助手】页面
2. 点击"新建会话"按钮
3. 配置会话参数：
   - **会话标题**：为会话命名
   - **使用的模型**：选择 GLM 模型版本
   - **系统提示词**：设置 AI 角色和行为
   - **温度参数**：0.0-2.0，越高越随机
   - **最大 Token 数**：限制响应长度
4. 点击"创建"开始对话

### 发送消息

**基本对话：**
1. 在输入框中输入问题
2. 点击"发送"或按 Enter
3. 等待 AI 响应
4. 查看回复内容

**流式输出：**
- 启用流式输出后，AI 响应会逐字显示
- 提供更实时的交互体验

### 系统提示词

系统提示词用于定义 AI 的角色和行为模式：

**示例 1 - 代码助手：**
```
你是一位经验丰富的编程专家，精通多种编程语言。
请帮助用户解决编程问题，提供清晰、可运行的代码示例。
```

**示例 2 - 写作助手：**
```
你是一位专业的写作助手，擅长润色和改写文本。
请保持原意不变，改进文章的表达和流畅度。
```

**示例 3 - 翻译助手：**
```
你是一位专业的翻译，精通中英文互译。
请准确翻译原文，保持语境和专业术语的一致性。
```

### 参数说明

#### 温度参数 (Temperature)

控制输出的随机性和创造性：

| 参数值 | 效果 | 适用场景 |
|--------|------|----------|
| 0.0 - 0.3 | 确定性高，输出稳定 | 事实问答、代码生成 |
| 0.4 - 0.7 | 平衡随机性和稳定性 | 日常对话、内容创作 |
| 0.8 - 1.5 | 高度随机和创造性 | 创意写作、头脑风暴 |
| 1.6 - 2.0 | 极高随机性 | 实验性应用 |

#### 最大 Token 数 (Max Tokens)

限制响应的最大长度：

- **2048**：简短回答
- **4096**：标准回答（默认）
- **8192**：长篇内容
- **16384**：超长文档

### 查看历史记录

1. 在会话列表中选择会话
2. 滚动查看历史对话
3. 点击消息可查看详细信息

### 删除会话

1. 在会话列表中找到要删除的会话
2. 点击"删除"按钮
3. 确认删除操作

**注意**：删除会话会同时删除该会话的所有消息记录。

## AI配置管理

### 添加配置

1. 进入【AI配置】管理页面
2. 点击"新建配置"按钮
3. 填写配置信息：
   - **配置名称**：唯一标识名称
   - **API Key**：智谱 API 密钥
   - **API 基础 URL**：API 服务地址
   - **默认模型**：glm-4-plus、glm-4-0520、glm-4-air、glm-4-flash
   - **默认温度**：默认温度参数
   - **默认最大 Token 数**：默认 token 限制
   - **是否启用**：启用状态
4. 点击"确定"保存配置

### 编辑配置

1. 在配置列表中找到要编辑的配置
2. 点击"编辑"按钮
3. 修改配置信息
4. 点击"确定"保存更改

### 删除配置

1. 在配置列表中找到要删除的配置
2. 点击"删除"按钮
3. 确认删除操作

**注意**：删除配置前，请确保没有会话正在使用该配置。

## 模型说明

### GLM-4 系列

| 模型 | 特点 | 适用场景 |
|------|------|----------|
| glm-4-plus | 最强性能 | 复杂推理、深度分析 |
| glm-4-0520 | 稳定版本 | 日常对话、通用任务 |
| glm-4-air | 轻量高效 | 快速响应、简单任务 |
| glm-4-flash | 极速响应 | 实时交互、高频调用 |

### 模型选择建议

- **复杂任务**：选择 glm-4-plus
- **日常使用**：选择 glm-4-0520
- **快速响应**：选择 glm-4-air 或 glm-4-flash

## Token 计费说明

### Token 说明

Token 是文本的基本计量单位：
- 中文：约 1-2 个汉字 = 1 Token
- 英文：约 4 个字符 = 1 Token
- 代码：约 3-4 个字符 = 1 Token

### 计费方式

```
总费用 = 输入 Token × 单价 + 输出 Token × 单价
```

### 查看使用情况

每条消息都会显示 Token 使用情况：
- **Prompt Tokens**：输入 Token 数
- **Completion Tokens**：输出 Token 数
- **Total Tokens**：总 Token 数

## 常见问题

### Q1: 如何获取智谱 API Key？

A:
1. 访问智谱 AI 开放平台
2. 注册并登录账号
3. 进入 API Keys 管理页面
4. 创建新的 API Key
5. 复制并保存 API Key

### Q2: 温度参数如何设置？

A:
- **0.2**：适用于需要准确答案的场景（如数学、编程）
- **0.7**：默认值，适用于大多数场景
- **1.0**：适用于需要创造性的场景（如写作、头脑风暴）
- **1.5+**：实验性使用，输出可能不稳定

### Q3: 为什么 AI 回复被截断？

A:
- 检查"最大 Token 数"设置
- 增加 Max Tokens 值
- 或拆分问题为多个小问题

### Q4: 如何提高回答质量？

A:
1. **优化提示词**：清晰描述问题，提供上下文
2. **调整温度**：降低温度获得更确定的答案
3. **使用系统提示词**：明确 AI 的角色和要求
4. **提供示例**：给出期望的输出格式示例

### Q5: 会话可以导出吗？

A:
- 可以通过复制对话内容导出
- 未来版本将支持 Markdown 格式导出

## API 接口

### 会话管理

```
POST /aiagent/conversation/create    # 创建会话
PUT /aiagent/conversation/update     # 更新会话
DELETE /aiagent/conversation/delete  # 删除会话
GET /aiagent/conversation/find       # 查询会话
GET /aiagent/conversation/getList    # 获取会话列表
```

### 消息管理

```
GET /aiagent/message/getList         # 获取消息列表
DELETE /aiagent/message/delete       # 删除消息
```

### 对话接口

```
POST /aiagent/chat/sendMessage       # 发送消息
```

### 配置管理

```
POST /aiagent/config/create          # 创建配置
PUT /aiagent/config/update           # 更新配置
DELETE /aiagent/config/delete        # 删除配置
GET /aiagent/config/find             # 查询配置
GET /aiagent/config/getList          # 获取配置列表
```

## 最佳实践

### 提示词工程

1. **明确角色**：告诉 AI 它的身份和专业领域
2. **提供上下文**：给出足够的背景信息
3. **明确要求**：清晰说明期望的输出格式
4. **使用示例**：提供参考示例引导 AI
5. **逐步提问**：复杂问题拆分为多个步骤

### 会话组织

1. **按主题分类**：不同主题使用不同会话
2. **命名规范**：使用描述性的会话标题
3. **定期清理**：删除不再需要的会话
4. **重要会话**：保留关键对话记录

### 成本优化

1. **选择合适的模型**：简单任务使用轻量模型
2. **控制 Token 数量**：合理设置最大 Token 数
3. **精简提示词**：去除冗余信息
4. **复用会话**：充分利用上下文减少重复

## 相关文档

- [模型微调](Model-Finetuning.md)

---

**最后更新**：2025-01-22
