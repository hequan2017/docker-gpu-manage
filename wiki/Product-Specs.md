# 产品规格管理

## 概述

产品规格管理功能用于定义 GPU 算力产品规格和定价，支持无显卡规格（CPU 容器）和显存切分功能。通过产品规格管理，可以实现标准化的 GPU 资源定价和分配。

## 功能特性

### 核心功能

- ✅ **灵活规格定义**：支持有显卡和无显卡两种规格
- ✅ **显存切分支持**：支持 HAMi 显存切分技术
- ✅ **标准化定价**：统一的计费标准
- ✅ **资源配额管理**：精确的 CPU、内存、磁盘配置
- ✅ **上架/下架管理**：控制产品规格的可用状态

## 数据模型

### 字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 名称 | string | ✅ | 规格名称 |
| 显卡型号 | string | | GPU 型号（GPU=0 时可为空） |
| 显卡数量 | int | | GPU 数量（0 表示无显卡） |
| 显存容量(GB) | int | | 显存容量 |
| 是否支持显存切分 | bool | ✅ | 默认否 |
| CPU核心数 | int | | CPU 核心数 |
| 内存(GB) | int | | 内存大小 |
| 系统盘容量(GB) | int | | 系统盘大小 |
| 数据盘容量(GB) | int | | 数据盘大小 |
| 价格/小时 | float64 | | 每小时价格 |
| 是否上架 | bool | ✅ | 默认上架 |
| 备注 | string | | 备注信息 |

## 使用指南

### 创建产品规格

1. 进入【产品规格】管理页面
2. 点击"新建规格"按钮
3. 填写规格信息：

#### GPU 配置
- **显卡型号**：如 "NVIDIA GeForce RTX 3090"
- **显卡数量**：如 1、2、4、8
- **显存容量**：单卡显存大小（GB），如 24
- **是否支持显存切分**：是否启用 HAMi 显存切分

#### CPU 和内存配置
- **CPU 核心数**：如 8、16、32、64
- **内存大小**：如 32、64、128、256（GB）

#### 磁盘配置
- **系统盘容量**：如 100、200、500（GB）
- **数据盘容量**：如 500、1000、2000（GB）

#### 定价信息
- **价格/小时**：如 1.5、3.0、5.0（元/小时）

4. 点击"确定"创建规格

### 无显卡规格

产品规格支持 GPU 数量为 0 的配置，适用于纯 CPU 计算场景：

**特点：**
- 显卡数量设置为 0
- 显卡型号可以为空
- 创建容器时不挂载 GPU 参数
- 所有节点都可以匹配（只要满足 CPU、内存、磁盘要求）

**适用场景：**
- CPU 密集型计算
- 数据处理应用
- Web 服务
- 开发测试环境

### 显存切分规格

启用显存切分的产品规格具有以下特点：

**配置要求：**
1. 将"是否支持显存切分"设置为"是"
2. 选择支持显存切的镜像库
3. 算力节点配置 HAMi-core 目录

**创建容器时的自动配置：**
- 挂载 HAMi-core 库到容器
- 注入显存切分环境变量
- 配置 GPU 设备映射

### 编辑产品规格

1. 在规格列表中找到要编辑的规格
2. 点击"编辑"按钮
3. 修改规格信息
4. 点击"确定"保存更改

### 删除产品规格

1. 在规格列表中找到要删除的规格
2. 点击"删除"按钮
3. 确认删除操作

**注意**：
- 删除规格前，请确保没有正在使用该规格的容器实例
- 删除规格后，无法恢复

### 上架/下架规格

1. 在规格列表中找到要操作的规格
2. 点击"上架"或"下架"按钮
3. 确认操作

- **上架**：规格可在创建容器时选择
- **下架**：规格不可见，无法创建新容器

## 智能主机匹配

### 匹配规则

创建容器时，系统会根据产品规格自动匹配最优算力节点：

1. **GPU 匹配**（GPU > 0）
   - 显卡型号必须相同
   - 显卡数量必须充足
   - 显存容量必须充足（支持显存切分时）

2. **CPU 匹配**
   - CPU 核心数必须充足

3. **内存匹配**
   - 内存大小必须充足

4. **磁盘匹配**
   - 系统盘空间必须充足
   - 数据盘空间必须充足

### 匹配优先级

1. **显存利用率**：优先选择显存利用率最高的节点
2. **GPU 利用率**：优先选择 GPU 数量充足的节点
3. **资源余量**：优先选择资源余量最小的节点

## 定价策略

### 计费方式

系统采用按时计费的方式：

- **计费单位**：元/小时
- **计费周期**：按小时计费
- **计费精度**：精确到分

### 价格计算

```
总费用 = 价格/小时 × 使用时长（小时）
```

**示例：**
- 使用 RTX 3090 规格（5元/小时）
- 使用时长：3.5 小时
- 总费用：5 × 3.5 = 17.5 元

### 建议定价

| GPU 型号 | 显存 | 价格/小时 | 说明 |
|---------|------|----------|------|
| RTX 3060 | 12GB | 1.5 | 入门级 |
| RTX 3090 | 24GB | 3.0 | 主流级 |
| RTX 4090 | 24GB | 5.0 | 高性能 |
| A100 | 40GB | 10.0 | 专业级 |
| H100 | 80GB | 20.0 | 企业级 |

## 规格模板

### 入门级规格

**适用于：**
- 学习和教学
- 小型实验项目
- 开发测试环境

**配置示例：**
- 显卡：RTX 3060 × 1
- 显存：12GB
- CPU：8 核
- 内存：32GB
- 磁盘：200GB

### 主流级规格

**适用于：**
- 中型机器学习项目
- 数据分析
- Web 应用

**配置示例：**
- 显卡：RTX 3090 × 1
- 显存：24GB
- CPU：16 核
- 内存：64GB
- 磁盘：500GB

### 高性能规格

**适用于：**
- 大型深度学习项目
- 科学计算
- 生产环境

**配置示例：**
- 显卡：RTX 4090 × 2
- 显存：24GB × 2
- CPU：32 核
- 内存：128GB
- 磁盘：1000GB

## 常见问题

### Q1: 如何创建无显卡规格？

A:
1. 创建产品规格时
2. 将"显卡数量"设置为 0
3. 显卡型号可以留空
4. 配置 CPU、内存、磁盘资源

### Q2: 显存切分规格有什么特殊要求？

A:
1. 需要将"是否支持显存切分"设置为"是"
2. 需要选择支持显存切的镜像库
3. 算力节点需要配置 HAMi-core 目录
4. 创建容器时会自动配置显存切分参数

### Q3: 如何修改产品规格的价格？

A:
1. 在产品规格列表中找到要修改的规格
2. 点击"编辑"按钮
3. 修改"价格/小时"字段
4. 点击"确定"保存

### Q4: 删除规格后，已创建的容器会受影响吗？

A:
- 已创建的容器不受影响
- 无法继续使用该规格创建新容器
- 建议先下架规格，而不是删除

### Q5: 如何设置合理的定价？

A:
参考以下因素：
1. GPU 型号和性能
2. 显存大小
3. CPU 和内存配置
4. 市场行情
5. 竞争对手定价

## API 接口

### 创建产品规格
```
POST /productSpecs/createProductSpec
```

### 更新产品规格
```
PUT /productSpecs/updateProductSpec
```

### 删除产品规格
```
DELETE /productSpecs/deleteProductSpec
```

### 查询产品规格
```
GET /productSpecs/findProductSpec
```

### 获取产品规格列表
```
GET /productSpecs/getProductSpecsList
```

## 相关文档

- [容器实例管理](Container-Instances.md)
- [算力节点管理](Compute-Nodes.md)
- [镜像库管理](Image-Registry.md)

---

**最后更新**：2025-01-22
